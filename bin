#!/bin/bash
set -euo pipefail;

name="${1:-untitled-project}";

git clone https://github.com/otter-academy/template.git "${name}" --origin template --depth 1 --single-branch --no-tags;

pushd "${name}";

message="initial commit

using otter-academy/template@$(git rev-parse HEAD)
                    $(git show -s --format=%s)"


git branch --unset-upstream;

git tag template;

git config user.name || git config user.name "user";
git config user.email || git config user.email "user@localhost";

git reset "$(git commit-tree HEAD^{tree} -m "${message}")";

git tag initial;

git --no-pager log --graph --decorate --format=raw --all;
echo;
pwd;
echo;
source ./yarn run create;
echo;
git --no-pager log --graph --decorate --format=raw --all;
